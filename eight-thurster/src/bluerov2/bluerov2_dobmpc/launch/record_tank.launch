<launch>
    <!-- Launch the record script with delay to wait for simulation to start -->
    <node name="rosbag_recorder" pkg="rostopic" type="rostopic" output="screen" 
          args="echo /bluerov2/pose_gt" 
          launch-prefix="bash -c 'echo \"Waiting for simulation to start...\"; while ! rostopic list | grep -q \"/bluerov2/pose_gt\"; do sleep 1; done; echo \"Simulation detected! Starting recording...\"; timeout 60 rosbag record -O /home/zeb/test-8/eight-thurster/src/bluerov2/bluerov2_dobmpc/rosbag/bluerov2_dobmpc_$(date +%Y%m%d_%H%M%S).bag /bluerov2/pose_gt /bluerov2/mpc/reference /bluerov2/mpc/error /bluerov2/ekf/pose /bluerov2/ekf/disturbance /bluerov2/thrusters/0/thrust /bluerov2/thrusters/1/thrust /bluerov2/thrusters/2/thrust /bluerov2/thrusters/3/thrust /bluerov2/thrusters/4/thrust /bluerov2/thrusters/5/thrust /bluerov2/thrusters/6/thrust /bluerov2/thrusters/7/thrust /bluerov2/thrusters/0/input /bluerov2/thrusters/1/input /bluerov2/thrusters/2/input /bluerov2/thrusters/3/input /bluerov2/thrusters/4/input /bluerov2/thrusters/5/input /bluerov2/thrusters/6/input /bluerov2/thrusters/7/input /bluerov2/control_input/0 /bluerov2/control_input/1 /bluerov2/control_input/2 /bluerov2/control_input/3; echo \"Recording completed!\"; if [ $? -eq 124 ]; then echo \"Recording finished after 60 seconds\"; else echo \"Recording stopped manually\"; fi'"/>
</launch> 